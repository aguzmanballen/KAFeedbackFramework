<!-
    HTML Validation: http://validator.w3.org/
-->

<! DOCTYPE HTML>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Khan Academy Project</title>
    <script src="KAFeedback.js"></script>
    <link rel="stylesheet" media="screen" href="KAWebpage.css" >
</head>
<body>
    <h1>
        Khan Academy Code Analyzer
    </h1>

    <div id="editor" style="float: left"></div>

    <h2>
        For this exercise, you will be required to write code that contain the following:
    </h2>
    <ul id="WhiteList">
    </ul>
    <h2>
        When your code meets some of the criteria, a check will appear alongside it.
    </h2>

    <!-  Khan Academy Code Structure Framework  -->
    <script src="scripts/KAFeedbackFramework.js" type="text/javascript" charset="utf-8"></script>
    <script>
        var KAFeedback = new KAFeedbackFramework();

        var myWhiteList = ['WhileStatement', 'ForStatement', 'VariableDeclaration'];
        var myBlackList = ["IfStatement"];//["for"];
        var myCodeStructure = ["lol"];

        KAFeedback.initializeWhiteList(myWhiteList);
        KAFeedback.initializeBlackList(myBlackList);
        KAFeedback.initializeCodeStructure(myCodeStructure);

        var listElement = document.getElementById("WhiteList");

        for(var element in myWhiteList) {
            var listItem = document.createElement("li");
            listItem.id = myWhiteList[element] + 'li';
            listItem.innerHTML = myWhiteList[element];

            // add listItem to the listElement
            listElement.appendChild(listItem);
        }
    </script>

    <!-  ACE Editor  -->
    <script src="acorn/acorn.js" type="text/javascript" charset="utf-8"></script>
    <script src="acorn/util/walk.js" type="text/javascript" charset="utf-8"></script>
    <script src="ace-builds/src-noconflict/ace.js" type="text/javascript" charset="utf-8"></script>
    <script>
        var editor = ace.edit("editor");
        editor.setTheme("ace/theme/khan_academy");
        editor.getSession().setMode("ace/mode/javascript");

        var whiteListFeedback = "";
        var blackListFeedback = "";
        var codeStructureFeedback = "";
        var extractedAST;

        editor.getSession().on('changeAnnotation', function(e) {
            var textEditorString = editor.getValue();
            extractedAST = KAFeedback.extractASTFromString(textEditorString);

            whiteListFeedback = KAFeedback.testCodeForWhiteListElements(textEditorString, extractedAST);
            blackListFeedback = KAFeedback.testCodeForBlackListElements(textEditorString, extractedAST);
            codeStructureFeedback = KAFeedback.testCodeForCorrectStructure(textEditorString, extractedAST);

            for(var element in myWhiteList) {
                var listItem = document.getElementById(myWhiteList[element] + 'li');

                if(KAFeedback.whiteList[myWhiteList[element]] == 1) {
                    listItem.innerHTML = '☑ ' + myWhiteList[element];// + myWhiteList[element];
                } else {
                    listItem.innerHTML = '☐ ' + myWhiteList[element];
                }
            }
        });

        editor.commands.addCommand({
            name: 'myCommand',
            bindKey: {win: 'Ctrl-M',  mac: 'Command-M'},
            exec: function(editor) {
            },
            readOnly: true // false if this command should not apply in readOnly mode
        });
    </script>

</body>
</html>